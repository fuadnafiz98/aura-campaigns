import{r as n,j as e,E as Q,J as Y,G as _,D as Z,T as A,I as T,at as ee,K as te,$ as F,b as B,a1 as se,B as L}from"./index-BhShMgCK.js";import{u as re}from"./index-Bnoxgq91.js";import{k as ae,D as oe,e as ne,f as de,g as ce,h as ie}from"./dialog-WUoby_ld.js";import{U as le,a as ue}from"./index-CzbL-Jco.js";import{a as E}from"./api-CEFOjK8t.js";var S="Checkbox",[pe,ve]=Q(S),[fe,O]=pe(S);function he(a){const{__scopeCheckbox:c,checked:p,children:o,defaultChecked:d,disabled:s,form:f,name:h,onCheckedChange:i,required:g,value:m="on",internal_do_not_use_render:u}=a,[x,C]=Z({prop:p,defaultProp:d??!1,onChange:i,caller:S}),[v,j]=n.useState(null),[k,l]=n.useState(null),t=n.useRef(!1),N=v?!!f||!!v.closest("form"):!0,I={checked:x,disabled:s,setChecked:C,control:v,setControl:j,name:h,form:f,value:m,hasConsumerStoppedPropagationRef:t,required:g,defaultChecked:y(d)?!1:d,isFormControl:N,bubbleInput:k,setBubbleInput:l};return e.jsx(fe,{scope:c,...I,children:me(u)?u(I):o})}var M="CheckboxTrigger",V=n.forwardRef(({__scopeCheckbox:a,onKeyDown:c,onClick:p,...o},d)=>{const{control:s,value:f,disabled:h,checked:i,required:g,setControl:m,setChecked:u,hasConsumerStoppedPropagationRef:x,isFormControl:C,bubbleInput:v}=O(M,a),j=A(d,m),k=n.useRef(i);return n.useEffect(()=>{const l=s==null?void 0:s.form;if(l){const t=()=>u(k.current);return l.addEventListener("reset",t),()=>l.removeEventListener("reset",t)}},[s,u]),e.jsx(_.button,{type:"button",role:"checkbox","aria-checked":y(i)?"mixed":i,"aria-required":g,"data-state":H(i),"data-disabled":h?"":void 0,disabled:h,value:f,...o,ref:j,onKeyDown:T(c,l=>{l.key==="Enter"&&l.preventDefault()}),onClick:T(p,l=>{u(t=>y(t)?!0:!t),v&&C&&(x.current=l.isPropagationStopped(),x.current||l.stopPropagation())})})});V.displayName=M;var G=n.forwardRef((a,c)=>{const{__scopeCheckbox:p,name:o,checked:d,defaultChecked:s,required:f,disabled:h,value:i,onCheckedChange:g,form:m,...u}=a;return e.jsx(he,{__scopeCheckbox:p,checked:d,defaultChecked:s,disabled:h,required:f,onCheckedChange:g,name:o,form:m,value:i,internal_do_not_use_render:({isFormControl:x})=>e.jsxs(e.Fragment,{children:[e.jsx(V,{...u,ref:c,__scopeCheckbox:p}),x&&e.jsx(z,{__scopeCheckbox:p})]})})});G.displayName=S;var K="CheckboxIndicator",$=n.forwardRef((a,c)=>{const{__scopeCheckbox:p,forceMount:o,...d}=a,s=O(K,p);return e.jsx(Y,{present:o||y(s.checked)||s.checked===!0,children:e.jsx(_.span,{"data-state":H(s.checked),"data-disabled":s.disabled?"":void 0,...d,ref:c,style:{pointerEvents:"none",...a.style}})})});$.displayName=K;var q="CheckboxBubbleInput",z=n.forwardRef(({__scopeCheckbox:a,...c},p)=>{const{control:o,hasConsumerStoppedPropagationRef:d,checked:s,defaultChecked:f,required:h,disabled:i,name:g,value:m,form:u,bubbleInput:x,setBubbleInput:C}=O(q,a),v=A(p,C),j=ee(s),k=re(o);n.useEffect(()=>{const t=x;if(!t)return;const N=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(N,"checked").set,D=!d.current;if(j!==s&&w){const R=new Event("click",{bubbles:D});t.indeterminate=y(s),w.call(t,y(s)?!1:s),t.dispatchEvent(R)}},[x,j,s,d]);const l=n.useRef(y(s)?!1:s);return e.jsx(_.input,{type:"checkbox","aria-hidden":!0,defaultChecked:f??l.current,required:h,disabled:i,name:g,value:m,form:u,...c,tabIndex:-1,ref:v,style:{...c.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});z.displayName=q;function me(a){return typeof a=="function"}function y(a){return a==="indeterminate"}function H(a){return y(a)?"indeterminate":a?"checked":"unchecked"}function je({className:a,...c}){return e.jsx(G,{"data-slot":"checkbox",className:te("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...c,children:e.jsx($,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(ae,{className:"size-3.5"})})})}const ye=({open:a,onOpenChange:c,audienceId:p})=>{const[o,d]=n.useState(null),[s,f]=n.useState(!1),[h,i]=n.useState(!1),[g,m]=n.useState(0),u=n.useRef(null),[x,C]=n.useState(null),v=F(E.fileUpload.generateUploadUrl),j=F(E.fileUpload.sendFile),k=B(E.user.getUserInfo),l=se(E.csvWorkflow.KSCSVImportWf),t=B(E.csvWorkflow.CSVImportWfTask,x?{id:x}:"skip"),N=r=>{d(r)},I=r=>{r.preventDefault(),f(!1);const b=r.dataTransfer.files[0];b&&b.type==="text/csv"&&N(b)},w=r=>{r.preventDefault(),f(!0)},D=()=>{f(!1)},R=()=>{W().catch(r=>{console.error("Import failed:",r)})},W=async()=>{if(o)try{i(!0),m(0),console.log("Importing file:",o.name);const r=await v(),b=await ue.post(r,o,{headers:{"Content-Type":o.type},onUploadProgress:U=>{if(U.total){const J=Math.round(U.loaded*100/U.total);m(J)}}});console.log("Upload successful:",b.data);const{storageId:P}=await b.data;k!=null&&k.userId&&await j({storageId:P,author:k.userId}),C(P),i(!1),m(0),await l({storageId:P,audienceId:p}),d(null)}catch(r){console.error("Upload failed:",r),i(!1),m(0)}},X=r=>{r||(d(null),f(!1),i(!1),m(0),C(null)),c(r)};return n.useEffect(()=>{(t==null?void 0:t.status)==="DONE"&&(C(null),c(!1))},[c,t]),e.jsx(oe,{open:a,onOpenChange:X,children:e.jsxs(ne,{className:"max-w-xl",children:[e.jsxs(de,{children:[e.jsx(ce,{children:"Upload Leads"}),e.jsx(ie,{children:"Upload a CSV file to import new leads. Expected columns: name, email, company, category"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${s?"border-primary bg-accent dark:bg-accent":"border-border hover:border-muted-foreground"}`,onDrop:I,onDragOver:w,onDragLeave:D,onClick:()=>{var r;return(r=u.current)==null?void 0:r.click()},role:"button",tabIndex:0,onKeyDown:r=>{var b;(r.key==="Enter"||r.key===" ")&&((b=u.current)==null||b.click())},"aria-label":"Drop CSV file here or click to browse",children:[e.jsx(le,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:"Drop your CSV file here"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"or click to browse"}),e.jsx("input",{ref:u,type:"file",accept:".csv",onChange:r=>{var b;return((b=r.target.files)==null?void 0:b[0])&&N(r.target.files[0])},className:"hidden","aria-hidden":"true"})]}),o&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{onClick:R,className:"flex-1 cursor-pointer",disabled:h,children:h?`Uploading... ${g}%`:"Import Leads"}),e.jsx(L,{variant:"outline",onClick:()=>d(null),className:"cursor-pointer",disabled:h,children:"Remove"})]}),o&&e.jsxs("div",{className:"p-3 bg-muted border rounded",children:[e.jsx("p",{className:"text-sm font-medium",children:o.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(o.size/1024).toFixed(1)," KB"]}),h&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[g,"%"]})]}),e.jsx("div",{className:"w-full bg-secondary rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${g}%`}})})]})]}),t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[t.status!=="DONE"&&e.jsx("div",{className:"w-3 h-3 border border-primary border-t-transparent rounded-full animate-spin"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.status==="CREATED"&&"File Uploaded",t.status==="PROCESSING"&&"Processing CSV",t.status==="DONE"&&"Import Complete"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary rounded-full transition-all duration-700 ease-out",style:{width:`${t.status==="CREATED"?"33%":t.status==="PROCESSING"?"66%":t.status==="DONE"?"100%":"0%"}`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:"Progress"}),e.jsx("span",{children:t.status==="CREATED"?"33%":t.status==="PROCESSING"?"66%":t.status==="DONE"?"100%":"0%"})]})]})]}):x?e.jsx("div",{children:e.jsx("div",{className:"w-full h-10 text-xs bg-secondary rounded-md overflow-hidden flex flex-col justify-center px-4",children:"Starting CSV Import..."})}):""]})]})})};export{je as C,ye as U};
