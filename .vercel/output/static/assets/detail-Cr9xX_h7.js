import{j as e,L as M,a4 as z,a as V,r as h,b as f,$ as Q,C as N,f as b,c as q,B as v,A as G,d as J,e as K,g as W,a0 as L}from"./index-BhShMgCK.js";import{a as u}from"./api-CEFOjK8t.js";import{T as X,a as Y,b as j,c as m,d as Z,e as c}from"./table-CbE_oz1G.js";import{C as w,U as ee}from"./import-leads-8jIQWl06.js";import{S as se,a as ae,b as re,c as te,d as p}from"./dialog-WUoby_ld.js";import{B as ne,a as le,b as A,d as k,e as B,c as ce}from"./breadcrumb-CUrFtPGy.js";import{D as ie}from"./delete-confirmation-dialog-C1rUYhYA.js";import{T as de}from"./trash-TkbFw94P.js";import{U as oe}from"./index-CzbL-Jco.js";import{A as me}from"./arrow-up-down-DB451iIV.js";import"./index-Bnoxgq91.js";import"./triangle-alert--dCDEp0T.js";function xe({items:r}){return e.jsx(ne,{children:e.jsxs(le,{children:[e.jsx(A,{children:e.jsx(k,{href:"/",children:"Home"})}),e.jsx(B,{}),r.map((x,n)=>{const o=n===r.length-1;return e.jsx(A,{children:o?e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(ce,{children:x.label})]}):e.jsx(e.Fragment,{children:e.jsx(k,{asChild:!0,children:e.jsx(M,{to:x.href||"#",children:x.label})})})},n)})]})})}function Le(){const{audienceId:r}=z(),x=V(),[n,o]=h.useState([]),[C,D]=h.useState("name"),[T,S]=h.useState(!1),[I,g]=h.useState(!1),[R,y]=h.useState(!1),a=f(u.audiences.getAudience,r?{id:r}:"skip"),t=f(u.audiences.getAudienceLeads,r?{audienceId:r,sortBy:C}:"skip"),O=f(u.audiences.getAudienceLeadsCount,r?{audienceId:r}:"skip"),U=Q(u.audiences.removeLeadFromAudience),i=n.length,$=s=>{o(d=>d.includes(s)?d.filter(l=>l!==s):[...d,s])},P=()=>{if(!t)return;const s=t.map(l=>l._id),d=s.every(l=>n.includes(l));o(d?l=>l.filter(H=>!s.includes(H)):l=>[...new Set([...l,...s])])},E=()=>{i===0||!r||g(!0)},F=async()=>{if(!(i===0||!r)){y(!0);try{await Promise.all(n.map(s=>U({audienceId:r,leadId:s}))),L.success(`${i} lead(s) removed from audience`),o([]),g(!1)}catch(s){L.error(`Error removing leads: ${s.message}`)}finally{y(!1)}}},_=s=>new Date(s).toLocaleDateString();return r?a===null?e.jsx(N,{className:"border-border m-4",children:e.jsx(b,{className:"p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Audience not found"})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full mx-5 mt-5 mb-2",children:e.jsx(xe,{items:[{label:"Audiences",href:"/audiences"},{label:(a==null?void 0:a.name)||"Loading..."}]})}),e.jsxs(N,{className:"border-border m-4",children:[e.jsx(q,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>x("/audiences"),className:"p-2 curosr-pointer",children:e.jsx(G,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx(J,{className:"text-sm",children:(a==null?void 0:a.name)||"Loading..."}),e.jsxs(K,{className:"text-sm",children:[(a==null?void 0:a.description)&&e.jsx("span",{className:"block",children:a.description}),"Showing ",(t==null?void 0:t.length)||0," of ",O||0," leads"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[i," selected"]}),e.jsxs(v,{size:"sm",variant:"outline",onClick:E,className:"h-10 text-sm bg-transparent hover:bg-destructive hover:text-destructive-foreground border-border cursor-pointer",children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"Remove"]})]}),e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>S(!0),className:"w-24 h-9 border-border text-sm bg-transparent cursor-pointer",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"Import"]}),e.jsxs(se,{value:C,onValueChange:D,children:[e.jsxs(ae,{className:"w-32 cursor-pointer h-10 border-border text-sm",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),e.jsx(re,{})]}),e.jsxs(te,{children:[e.jsx(p,{value:"name",children:"Name"}),e.jsx(p,{value:"email",children:"Email"}),e.jsx(p,{value:"company",children:"Company"}),e.jsx(p,{value:"added",children:"Date Added"})]})]})]})]})}),e.jsx(b,{className:"pt-0",children:e.jsxs(X,{className:"table-dense",children:[e.jsx(Y,{children:e.jsxs(j,{children:[e.jsx(m,{className:"w-8",children:e.jsx(w,{checked:t&&t.length>0&&n.length>0&&t.every(s=>n.includes(s._id)),onCheckedChange:P,"aria-label":"Select all leads on this page"})}),e.jsx(m,{className:"text-sm",children:"Name"}),e.jsx(m,{className:"text-sm",children:"Email"}),e.jsx(m,{className:"text-sm",children:"Company"}),e.jsx(m,{className:"text-sm",children:"Category"}),e.jsx(m,{className:"text-sm",children:"Added"})]})}),e.jsx(Z,{children:t?t.length===0?e.jsx(j,{children:e.jsx(c,{colSpan:6,className:"text-center text-muted-foreground",children:"No leads in this audience yet"})}):t.map(s=>e.jsxs(j,{className:"cursor-pointer hover:bg-accent",children:[e.jsx(c,{onClick:d=>d.stopPropagation(),children:e.jsx(w,{checked:n.includes(s._id),onCheckedChange:()=>$(s._id),"aria-label":`Select ${s.name}`})}),e.jsx(c,{className:"font-medium text-sm",children:s.name}),e.jsx(c,{className:"text-sm",children:s.email}),e.jsx(c,{className:"text-sm",children:s.company}),e.jsx(c,{children:e.jsx(W,{className:"text-sm py-0 px-1",children:s.category})}),e.jsx(c,{className:"text-sm",children:_(s.addedAt)})]},s._id)):e.jsx(j,{children:e.jsx(c,{colSpan:6,className:"text-center",children:"Loading leads..."})})})]})}),a&&e.jsx(ee,{open:T,onOpenChange:S,audienceId:r,audienceName:a.name}),e.jsx(ie,{open:I,onOpenChange:g,onConfirm:F,title:`Remove ${i} lead(s)?`,description:`Are you sure you want to remove ${i} lead(s) from "${a==null?void 0:a.name}"? This will not delete the leads completely, just remove them from this audience.`,loading:R})]})]}):e.jsx(N,{className:"border-border m-4",children:e.jsx(b,{className:"p-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Invalid audience ID"})})})}export{Le as default};
